<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .navbar {
            background-color: #002244; /* Your theme color */
            padding: 10px;
            color: white;
            text-align: center;
        }
        .navbar a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-size: 18px;
        }
        .container {
            width: 90%;
            margin: auto;
            padding: 20px;
        }
        .section {
            display: none;
            margin-top: 20px;
        }
        .section.active {
            display: block;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
        }
        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .button {
            padding: 10px 20px;
            background-color: green;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .property-list {
            margin-top: 20px;
        }
        .property-item {
            border-bottom: 1px solid #ccc;
            padding: 10px 0;
        }
        .property-item:last-child {
            border-bottom: none;
        }
        .property-item img {
            max-width: 100px;
            margin-right: 20px;
        }
        .property-actions {
            margin-top: 10px;
        }
        .edit-button,
        .delete-button {
            padding: 5px 10px;
            margin-right: 10px;
            background-color: orange;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-button {
            background-color: red;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="#" id="upload-nav">Upload Properties</a>
        <a href="#" id="manage-nav">Manage Properties</a>
    </div>

    <div class="container">
        <div class="section active" id="upload-section">
            <h2>Upload New Property</h2>
            <div class="input-group">
                <label for="property-title">Property Title:</label>
                <input type="text" id="property-title" required>
            </div>
            <div class="input-group">
                <label for="property-price">Price:</label>
                <input type="text" id="property-price" required>
            </div>
            <div class="input-group">
                <label for="property-location">Location:</label>
                <input type="text" id="property-location" required>
            </div>
            <div class="input-group">
                <label for="property-category">Category:</label>
                <input type="text" id="property-category" required>
            </div>
            <div class="input-group">
                <label for="property-subcategory">Subcategory:</label>
                <input type="text" id="property-subcategory" required>
            </div>
            <div class="input-group">
                <label for="property-image">Property Images:</label>
                <input type="file" id="property-image" multiple required>
            </div>
            <button class="button" id="upload-button">Upload Property</button>
            <p id="upload-message"></p>
        </div>

        <div class="section" id="manage-section">
            <h2>Manage Properties</h2>
            <div class="property-list" id="property-list">
                <!-- Properties will be displayed here -->
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"></script>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            databaseURL: "your-database-url",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const database = firebase.database();

        // Navigation
        document.getElementById('upload-nav').addEventListener('click', () => {
            document.getElementById('upload-section').classList.add('active');
            document.getElementById('manage-section').classList.remove('active');
        });

        document.getElementById('manage-nav').addEventListener('click', () => {
            document.getElementById('upload-section').classList.remove('active');
            document.getElementById('manage-section').classList.add('active');
            loadProperties(); // Load properties when navigating to manage section
        });

        // Upload new property
        document.getElementById('upload-button').addEventListener('click', async () => {
            const title = document.getElementById('property-title').value;
            const price = document.getElementById('property-price').value;
            const location = document.getElementById('property-location').value;
            const category = document.getElementById('property-category').value;
            const subcategory = document.getElementById('property-subcategory').value;
            const files = document.getElementById('property-image').files;

            if (!title || !price || !location || !category || !subcategory || files.length === 0) {
                alert('Please fill all fields and select images.');
                return;
            }

            try {
                const fileUploads = [];
                for (const file of files) {
                    const storageRef = storage.ref('property-images/' + file.name);
                    const snapshot = await storageRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    fileUploads.push(downloadURL);
                }

                const propertyRef = database.ref('properties').push();
                await propertyRef.set({
                    title,
                    price,
                    location,
                    category,
                    subcategory,
                    images: fileUploads
                });

                document.getElementById('upload-message').innerText = 'Property uploaded successfully!';
                document.getElementById('upload-message').style.color = 'green';

                // Clear the form after uploading
                document.getElementById('property-title').value = '';
                document.getElementById('property-price').value = '';
                document.getElementById('property-location').value = '';
                document.getElementById('property-category').value = '';
                document.getElementById('property-subcategory').value = '';
                document.getElementById('property-image').value = '';

            } catch (error) {
                console.error('Error uploading property:', error);
                document.getElementById('upload-message').innerText = 'Error uploading property. Please try again.';
                document.getElementById('upload-message').style.color = 'red';
            }
        });

        // Load properties
        function loadProperties() {
            const propertyList = document.getElementById('property-list');
            propertyList.innerHTML = ''; // Clear previous list

            const propertyRef = database.ref('properties');
            propertyRef.once('value', snapshot => {
                snapshot.forEach(childSnapshot => {
                    const property = childSnapshot.val();
                    const propertyKey = childSnapshot.key;

                    const propertyItem = document.createElement('div');
                    propertyItem.className = 'property-item';

                    const propertyInfo = `
                        <div>
                            <h3>${property.title}</h3>
                            <p>Price: ${property.price}</p>
                            <p>Location: ${property.location}</p>
                            <p>Category: ${property.category}</p>
                            <p>Subcategory: ${property.subcategory}</p>
                        </div>
                    `;

                    let propertyImages = '';
                    for (const imageUrl of property.images) {
                        propertyImages += `<img src="${imageUrl}" alt="${property.title}">`;
                    }
                    // Adding images and action buttons to the property item
                    const propertyActions = `
                        <div class="property-images">
                            ${propertyImages}
                        </div>
                        <div class="property-actions">
                            <button class="edit-button" onclick="editProperty('${propertyKey}')">Edit</button>
                            <button class="delete-button" onclick="deleteProperty('${propertyKey}')">Delete</button>
                        </div>
                    `;

                    propertyItem.innerHTML = propertyInfo + propertyActions;
                    propertyList.appendChild(propertyItem);
                });
            });
        }

        // Edit property (implementation will depend on how you want to handle this)
        function editProperty(propertyKey) {
            alert('Edit functionality is not implemented yet.');
            // You can add a similar form to upload to handle editing, pre-filling the fields with the existing data.
        }

        // Delete property
        function deleteProperty(propertyKey) {
            if (confirm('Are you sure you want to delete this property?')) {
                const propertyRef = database.ref('properties/' + propertyKey);
                propertyRef.remove()
                    .then(() => {
                        alert('Property deleted successfully!');
                        loadProperties(); // Refresh the list
                    })
                    .catch(error => {
                        console.error('Error deleting property:', error);
                        alert('Error deleting property. Please try again.');
                    });
            }
        }
    </script>
</body>
</html>
